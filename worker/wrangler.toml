# Amber Worker Configuration

name = "amber-worker"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "amber"
database_id = "f688021b-a986-495a-94bb-352354768a22"

# R2 Bucket
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "grove-storage"  # Run: wrangler r2 bucket create grove-storage

# Cron Triggers
[triggers]
crons = ["0 3 * * *"]  # Daily at 3 AM UTC

# Environment Variables
[vars]
GROVEAUTH_CLIENT_ID = "amber"
GROVEAUTH_AUTH_BASE_URL = "https://auth-api.grove.place"
ALLOWED_ORIGINS = "https://amber.grove.place"

# Secrets (set via: wrangler secret put GROVEAUTH_CLIENT_SECRET)
# - GROVEAUTH_CLIENT_SECRET

# Environment-specific settings
[env.production]
name = "amber-worker"
routes = [
  { pattern = "amber-api.grove.place/*", zone_name = "grove.place" }
]

[[env.production.d1_databases]]
binding = "DB"
database_name = "amber"
database_id = "f688021b-a986-495a-94bb-352354768a22"

[[env.production.r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "grove-storage"

[env.production.vars]
GROVEAUTH_AUTH_BASE_URL = "https://auth-api.grove.place"
ALLOWED_ORIGINS = "https://amber.grove.place"

[env.staging]
name = "amber-worker-staging"
[env.staging.vars]
ALLOWED_ORIGINS = "https://amber-staging.grove.place,http://localhost:5173"
